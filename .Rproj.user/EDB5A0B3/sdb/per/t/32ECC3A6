{
    "collab_server" : "",
    "contents" : "drawFwdCurvesWithPrice <- function(fwdStrCalInfo,spotPriceData)\n{\n  if (missing(spotPriceData))\n  {\n    spotPriceData <- fwdStrCalInfo[,c('QDate','SpotPrice')]\n  }\n  \n  plotFwdCurves <- \n    ggplot(data = fwdStrCalInfo , aes(x = as.Date(FwdYM), y = FwdPrice, group=QDate, color= LongTermStr)) +\n    geom_line(size=0.5) +\n    geom_line(data = spotPriceData, size=0.5,  aes(x = as.Date(QDate), y = SpotPrice, group=NULL), color=\"blue\") +\n    scale_y_continuous(breaks = seq(0,150,10))\n}\n\n\n\nggplot_dual_axis <- function(plot1, plot2, which.axis = \"y\") {\n  \n  grid.newpage()\n  \n  # Increase right margin if which.axis == \"y\"\n  if(which.axis == \"y\") plot1 = plot1 + theme(plot.margin = unit(c(0.7, 1.5, 0.4, 0.4), \"cm\"))\n  \n  # Extract gtable\n  g1 = ggplot_gtable(ggplot_build(plot1))\n  \n  g2 = ggplot_gtable(ggplot_build(plot2))\n  \n  # Overlap the panel of the second plot on that of the first\n  pp = c(subset(g1$layout, name == \"panel\", se = t:r))\n  \n  g = gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == \"panel\")]], pp$t, pp$l, pp$b, pp$l)\n  \n  # Steal axis from second plot and modify\n  axis.lab = ifelse(which.axis == \"x\", \"axis-b\", \"axis-l\")\n  \n  ia = which(g2$layout$name == axis.lab)\n  \n  ga = g2$grobs[[ia]]\n  \n  ax = ga$children[[2]]\n  \n  # Switch position of ticks and labels\n  if(which.axis == \"x\") ax$heights = rev(ax$heights) else ax$widths = rev(ax$widths)\n  \n  ax$grobs = rev(ax$grobs)\n  \n  if(which.axis == \"x\") \n    \n    ax$grobs[[2]]$y = ax$grobs[[2]]$y - unit(1, \"npc\") + unit(0.15, \"cm\") else\n      \n      ax$grobs[[1]]$x = ax$grobs[[1]]$x - unit(1, \"npc\") + unit(0.15, \"cm\")\n  \n  # Modify existing row to be tall enough for axis\n  if(which.axis == \"x\") g$heights[[2]] = g$heights[g2$layout[ia,]$t]\n  \n  # Add new row or column for axis label\n  if(which.axis == \"x\") {\n    \n    g = gtable_add_grob(g, ax, 2, 4, 2, 4) \n    \n    g = gtable_add_rows(g, g2$heights[1], 1)\n    \n    g = gtable_add_grob(g, g2$grob[[6]], 2, 4, 2, 4)\n    \n  } else {\n    \n    g = gtable_add_cols(g, g2$widths[g2$layout[ia, ]$l], length(g$widths) - 1)\n    \n    g = gtable_add_grob(g, ax, pp$t, length(g$widths) - 1, pp$b) \n    \n    g = gtable_add_grob(g, g2$grob[[7]], pp$t, length(g$widths), pp$b - 1)\n    \n  }\n  \n  #g\n  # Draw it\n grid.draw(g)\n  \n  \n}\n\n\ndrawContourCurve <- function(fwdStrBasicInfo,interestPeriod.start,interestPeriod.end)\n{\n  \n  if(missing(interestPeriod.start))\n  {\n    interestPeriod.start <- min(fwdStrBasicInfo$QDate)\n  }\n  \n  if(missing(interestPeriod.end))\n  {\n    interestPeriod.end <- max(fwdStrBasicInfo$QDate)\n  }\n  \n  \n  fwdStrBasicInfo <- fwdStrBasicInfo[fwdStrBasicInfo$QDate >= interestPeriod.start & fwdStrBasicInfo$QDate <= interestPeriod.end  , ] \n  \n  p1 <- ggplot(data = fwdStrBasicInfo, aes(x = QDate, y = FwdDelta, group=MMDiff, color= sprintf(\"%02d\",MMDiff))) +\n    geom_line(size=0.2) +\n    geom_line(data = fwdStrBasicInfo , aes(x = QDate, y = SpotPrice / 10, group = NULL), size=1, color = 'blue') +\n    scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\") +\n    scale_y_continuous(breaks = seq(-50,50,2.5))\n  \n  #p2 <- ggplot(data = fwdStrBasicInfo , aes(x = QDate, y = SpotPrice, group = NULL)) +\n  #  geom_line(size=0.7, color = 'blue') +\n  #  scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\")\n  \n  ##pp <- ggplot_dual_axis( p1, p2)\n  \n}\n\n\ndrawFwdPrice <- function(fwdStrBasicInfo,interestPeriod.start,interestPeriod.end)\n{\n  \n  if(missing(interestPeriod.start))\n  {\n    interestPeriod.start <- min(fwdStrBasicInfo$QDate)\n  }\n  \n  if(missing(interestPeriod.end))\n  {\n    interestPeriod.end <- max(fwdStrBasicInfo$QDate)\n  }\n  \n  fwdStrBasicInfo <- fwdStrBasicInfo[fwdStrBasicInfo$QDate >= interestPeriod.start & fwdStrBasicInfo$QDate <= interestPeriod.end  , ] \n  \n  p1 <- ggplot(data = fwdStrBasicInfo, aes(x = QDate, y = FwdPrice, group=MMDiff, color= sprintf(\"%02d\",MMDiff))) +\n    geom_line(size=0.2) +\n    geom_line(data = fwdStrBasicInfo , aes(x = QDate, y = SpotPrice, group = NULL), size=1, color = 'blue') +\n    scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\") +\n    scale_y_continuous(breaks = seq(0,200,5))\n}\n\ndrawCorrelationTrend <- function(correlationInfo, spotPriceInfo, displayMM)\n{\n    corelationTrend <- ggplot(subset(correlationInfo, MMDiff %in% displayMM), \n                            aes(x = QDate, y = Estimate , group = MMDiff, col = sprintf(\"%02d\",MMDiff))) +\n    geom_line(size=0.5) +\n    geom_point(size=1.2) +\n    scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\") +\n    geom_line(data = spotPriceInfo, size = 1, aes(x = QDate, y = SpotPrice / 100, group = NULL), col = 'red' )\n}\n\n\ndrawSlopeTrend <- function(slopeTrend.Plot.Data)\n{\n  slopeTrend.Plot <- ggplot(data = slopeTrend.Plot.Data , \n                            aes(x = QDate, y = PWSlope , group = MMDiff, col = sprintf(\"%02d\" , MMDiff))) +\n    geom_line(size=0.5) +\n    #geom_point(size=1.2) +\n    geom_line(size = 1, aes(y = SpotPrice / 100, group = NULL), col = 'red' ) +\n    scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\")\n}\n\n\n",
    "created" : 1463115032593.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3655090855",
    "id" : "32ECC3A6",
    "lastKnownWriteTime" : 1463102834,
    "last_content_update" : 1463102834,
    "path" : "D:/My_Workplace/Project/SKTIStudy/FwdStructureAnaly/FwdAnalysisModel/92_DrawFunctions.R",
    "project_path" : "92_DrawFunctions.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 27,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}