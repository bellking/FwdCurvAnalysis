{
    "collab_server" : "",
    "contents" : "\nsummaryOfSlope <- aggregate(FwdDeltaWPrev ~ MMDiff + LongTermStr , summary, data=fwdStrCalInfo.MAvg)\nsummaryOfSlope.Detail <- summaryOfSlope$FwdDeltaWPrev\n\n#Arima of FwdDelta???\n\n# 1. plot of delta\ntestMMDiff <- 3\nfwdDeltTS.Daily <- fwdStrBasicInfo[fwdStrBasicInfo$MMDiff == testMMDiff,c('QDate','FwdDelta')]\nplot(fwdDeltTS.Daily, type = \"l\")\n\nfwdDeltTS.MAv <- fwdStrCalInfo.MAvg[fwdStrCalInfo.MAvg$MMDiff == testMMDiff,c('QDate','FwdDelta')]\nplot(fwdDeltTS.MAv, type = \"l\")\n\ndisplayColor <- rainbow(max(fwdStrCalInfo.MAvg$MMDiff)+1)\n\ninterestPeriod.start <- '2006-05-15'\ninterestPeriod.end <- '2100-05-15'\n\n\n#regression fit for \ncurrentFwCurv <- fwdStrCalInfo.MAvg[fwdStrCalInfo.MAvg$QDate == as.Date('2016-02-15') & fwdStrCalInfo.MAvg$MMDiff > 3 & fwdStrCalInfo.MAvg$MMDiff > 0,c('MMDiff','FwdDelta')]\n#currentFwCurv$MMDiff <- currentFwCurv$MMDiff + 1 \n#currentFwCurv$MMDiff <- log(currentFwCurv$MMDiff + 1, exp(1)) \ncurrentFwCurv$FwdDelta <- - currentFwCurv$FwdDelta\n\ncurveFit <- lm(currentFwCurv$FwdDelta ~ log(currentFwCurv$MMDiff), exp(1))\nsummary(curveFit)\ncurveFit$\ncurrentFwCurv$FittedValue <- curveFit$fitted.values\n\n#plot(currentFwCurv$MMDiff,currentFwCurv$FwdDelta)\n#lines(currentFwCurv$MMDiff, currentFwCurv$FittedValue , col = \"red\" )\n\n#fittedCurve <- ggplot(data = currentFwCurv , aes(x = MMDiff, y = FwdDelta)) +\n  \n  # geom_line(size=0.5,  aes(x = as.numeric(QDate), y = SpotPrice, group=NULL), color=\"red\") +  \n#  geom_point(size=2) +\n#  geom_line(size = 0.5 , aes(x = MMDiff, y = FittedValue, group=NULL), color=\"red\")\n\n\n#print(fittedCurve)\n\n#delta pattern analysis\n\n#determine which dataset to use\n\n\n\ncurveChangeAnaylsis <- fwdStrBasicInfo[fwdStrBasicInfo$QYM > '2008-03-01',]\n#curveChangeAnaylsis <- fwdStrCalInfo.MAvg\n#\n#curveChangeAnaylsis$\ncurveChangeAnaylsis = ddply(curveChangeAnaylsis, .(FwdYM), mutate,\n                            SpotPriceDif = c(0, diff(SpotPrice, lag =1)),\n                            FwdPriceDif = c(0, diff(FwdPrice, lag = 1)))\n\ncurveChangeAnaylsis$Direction <- 'UP'\ncurveChangeAnaylsis[curveChangeAnaylsis$SpotPriceDif < 0 ,]$Direction <- 'DW'\n\n\ncurveChangeAnaylsis.summary <- ddply(curveChangeAnaylsis, .(QYM,MMDiff,Direction) , summarise,\n                                     correl = coefficients( lm(FwdPriceDif ~ SpotPriceDif) )[2],\n                                     mvgPrice = mean(SpotPrice) / 100)\n\ncurveChangeAnaylsis.summary <- ddply(curveChangeAnaylsis.summary, .(QYM) , mutate,\n                                     correlRatio = correl / correl[1])\n\n\n\n\n#sp <- curveChangeAnaylsis[curveChangeAnaylsis$MMDiff == 24 ,]$SpotPriceDif\n#fp <- curveChangeAnaylsis[curveChangeAnaylsis$MMDiff == 24 ,]$FwdPriceDif\n#& curveChangeAnaylsis$QYM == '2016-04-15'\n#moveFit <- lm(fp ~ sp)\n#summary(moveFit)\n#leveragePlots(moveFit)\n#plot(moveFit)\n\n\n#summary(moveFit)$coefficients[,4]\n#ggplot(data = curveChangeAnaylsis.summary[curveChangeAnaylsis.summary$MMDiff %in% displayMMDiff,] , \ndisplayMMDiff <- c(32)\n\ncurveChangeAnaylsis.summary$CorrelType <- paste(curveChangeAnaylsis.summary$Direction,sprintf(\"%02d\",curveChangeAnaylsis.summary$MMDiff))\n\ncorelationTrend <- ggplot(subset(curveChangeAnaylsis.summary, MMDiff %in% displayMMDiff), \n                          aes(x = QYM, y = correl , group = CorrelType, col = CorrelType)) +\n  geom_line(size=0.5) +\n  geom_point(size=1.2) +\n  scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\") +\n  geom_line(size = 1, aes(y = mvgPrice, group = NULL), col = 'red' )\n  \n \n#print(corelationTrend) #ppppp\n\n\ncurveChangeAnaylsis.daily <- curveChangeAnaylsis[curveChangeAnaylsis$MMDiff %in% displayMMDiff & abs(curveChangeAnaylsis$FwdPriceDif / curveChangeAnaylsis$SpotPriceDif) < 1.5,]\n\ncorelationTrend.daily <- ggplot(data = curveChangeAnaylsis.daily , \n          aes(x = QDate, y = FwdPriceDif / SpotPriceDif , group = MMDiff)) +\n  geom_line(size=0.5) +\n  geom_point(size=1.2) +\n  scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\") +\n  geom_line(size = 1, aes(y = SpotPrice / 100, group = NULL), col = 'red' )\n\n\nprint(corelationTrend.daily)\n\n\n####\ncurveChangeAnaylsis.Aggre <- aggregate(correlRatio ~ MMDiff , summary, data = curveChangeAnaylsis.summary[curveChangeAnaylsis.summary$MMDiff <= 24,])\ncurveChangeAnaylsis.Aggre$MeanDiff <- - c(0,diff(curveChangeAnaylsis.Aggre$correlRatio[,c('Mean')], lag =1))\n\nplot(curveChangeAnaylsis.Aggre$MMDiff,curveChangeAnaylsis.Aggre$MeanDiff)\ncorrelationRegFit <- lm( MeanDiff ~ MMDiff, data = curveChangeAnaylsis.Aggre[curveChangeAnaylsis.Aggre$MMDiff > 2,])\nsummary(correlationRegFit)\nleveragePlots(correlationRegFit)\nboxplot(correl ~ MMDiff , data=curveChangeAnaylsis.summary[curveChangeAnaylsis.summary$MMDiff <= 24,])\n\n########\n#slope change analysis\nbreakPoint <- c(1,2,6,12,30)\ndefaultPlayCycle <- breakPoint[2:3]\n\nslopeTrend.Analy <- fwdStrBasicInfo[fwdStrBasicInfo$QYM > '2008-03-01' & fwdStrBasicInfo$MMDiff %in% breakPoint,]\n\nmissingQDates <- ddply(slopeTrend.Analy, .(QDate) , summarise, nn = length(FwdPrice))\nmissingQDates <- missingQDates[missingQDates$nn < length(breakPoint),]$QDate\n\nslopeTrend.Analy <- slopeTrend.Analy[!(slopeTrend.Analy$QDate %in% missingQDates),]\n\nslopeTrend.Analy <- ddply(slopeTrend.Analy, .(QDate) , mutate,\n                          PWSlope =  c(0, diff(FwdPrice, lag = 1) / diff(breakPoint, lag = 1)))\n\nslopeTrend.Analy.MAvg <- ddply(slopeTrend.Analy, .(QYM,MMDiff) , summarise,\n                               PWSlope =  mean(PWSlope),\n                               SpotPrice = mean(SpotPrice))\nslopeTrend.Analy.MAvg$QDate <- slopeTrend.Analy.MAvg$QYM\n\nslopeTrend.Plot.Data <- slopeTrend.Analy\n\n#slopeTrend.Plot.Data <- slopeTrend.Analy.MAvg;\n\n\nslopeTrend.Plot <- ggplot(data = slopeTrend.Plot.Data , \n                          aes(x = QDate, y = PWSlope , group = MMDiff, col = sprintf(\"%02d\" , MMDiff))) +\n  geom_line(size=0.5) +\n  #geom_point(size=1.2) +\n  geom_line(size = 1, aes(y = SpotPrice / 100, group = NULL), col = 'red' ) +\n  scale_x_date(date_breaks = \"6 months\" , date_labels = \"%y/%b\")\n\n#print(drawSlopeTrend(createSlopeAnalysis(fwdStrBasicInfo, '2008-03-01', breakPoint = breakPoint))) #ppppp\n\nboxplot(PWSlope ~ MMDiff + LongTermStr, data=slopeTrend.Analy)\nslopeAnalysis.summary <- aggregate(PWSlope ~ MMDiff + LongTermStr, summary ,data=slopeTrend.Analy)\n#print(slopeAnalysis.summary)\n\nbestDefaultCycle <- slopeAnalysis.summary[slopeAnalysis.summary$LongTermStr == 'CNTG',][3,]$PWSlope\n\n",
    "created" : 1463093801753.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1306542602",
    "id" : "A4D1CE2C",
    "lastKnownWriteTime" : 1463114326,
    "last_content_update" : -2147483648,
    "path" : "D:/My_Workplace/Project/SKTIStudy/FwdStructureAnaly/FwdAnalysisModel/03_StructureAnalysis.R",
    "project_path" : "03_StructureAnalysis.R",
    "properties" : {
    },
    "relative_order" : 24,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}